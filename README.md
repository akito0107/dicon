# dicon

DICONtainer Generator for go.

## Getting Started

### Prerequisites
- Go 1.9+
- make

### Installing
```
$ go get -u github.com/akito0107/dicon
```

### How to use
1. Write container interface and comment `+DICON` over it.
```.go
// +DICON
type Container interface {
    UserService() UserService
    UserReposiotry() UserRepository
}
```
2. Prepare dependencies. You must write constructor which meets below requirements:
- method name must be `New` + Interface name
- return type must be single Interface.
- dependencies which use this instance must be passed via the constructor.

```userservice.go
type UserService interface {}

type userService struct {
    repo UserRepository
}

func NewUserService(repo UserRepotiroy) UserService {
    return &userService{
        repo: repo,
    }
}
```

```userrepository.go
type UserRepository interface {}

type userRepository struct {}

func NewUserRepository() UserRepository {
    return &userRepository{}
}
```
3. generate!
```
$ dicon generate --pkg sample
```

4. You can get the container implementation!
```
// Code generated by "dicon"; DO NOT EDIT.
package main

import (
	"log"
)

type dicontainer struct {
	store map[string]interface{}
}

func NewDIContainer() Container {
	return &dicontainer{
		store: map[string]interface{}{},
	}
}

func (d *dicontainer) UserRepository() UserRepository {
	if i, ok := d.store["UserRepository"]; ok {
		if instance, ok := i.(UserRepository); ok {
			return instance
		}
		log.Fatal("cached instance is polluted")
	}
	instance := repository.NewUserRepository()
	d.store["UserRepository"] = instance
	return instance
}
func (d *dicontainer) UserService() UserService {
	if i, ok := d.store["UserService"]; ok {
		if instance, ok := i.(UserService); ok {
			return instance
		}
		log.Fatal("cached instance is polluted")
	}
	dep0 := d.UserRepository()
	instance := service.NewUserService(dep0)
	d.store["UserService"] = instance
	return instance
    }
```

5. Use it!
```
di := NewDIContainer()
u := di.UserService()
....
```

## Options
```
$ dicon generate -h
NAME:
   dicon generate - generate dicon_gen file

USAGE:
   dicon generate [command options] [arguments...]

OPTIONS:
   --pkg value, -p value  target package(s).
   --out value, -o value  output file name (default: "dicon_gen")
   --dry-run
```

## TODOs
- [] fix imports

## License
This project is licensed under the Apache License 2.0 License - see the [LICENSE.md](LICENSE.md) file for details
